# 应用打包说明

## 一、生成签名密钥（首次打包）

如果还没有签名密钥文件，需要先生成一个：

### Windows (PowerShell)
```powershell
keytool -genkey -v -keystore app/release.keystore -alias release -keyalg RSA -keysize 2048 -validity 10000
```

### macOS/Linux
```bash
keytool -genkey -v -keystore app/release.keystore -alias release -keyalg RSA -keysize 2048 -validity 10000
```

**参数说明：**
- `-keystore`: 密钥库文件路径
- `-alias`: 密钥别名（建议使用 `release`）
- `-keyalg`: 密钥算法（RSA）
- `-keysize`: 密钥长度（2048 位）
- `-validity`: 有效期（10000 天，约 27 年）

执行后会提示输入：
- 密钥库密码（storePassword）
- 密钥密码（keyPassword，可与密钥库密码相同）
- 姓名、组织等信息（可随意填写）

## 二、配置签名信息

1. 复制 `keystore.properties.example` 为 `keystore.properties`：
   ```bash
   cp keystore.properties.example keystore.properties
   ```

2. 编辑 `keystore.properties`，填写实际的签名信息：
   ```properties
   storeFile=app/release.keystore
   storePassword=你的密钥库密码
   keyAlias=release
   keyPassword=你的密钥密码
   ```

**⚠️ 重要：** `keystore.properties` 文件已添加到 `.gitignore`，不会被提交到版本控制，请妥善保管。

## 三、生成 Release APK

### 方法一：使用 Gradle 命令（推荐）

在项目根目录执行：

**Windows:**
```powershell
.\gradlew assembleRelease
```

**macOS/Linux:**
```bash
./gradlew assembleRelease
```

生成的 APK 文件位置：`app/build/outputs/apk/release/app-release.apk`

### 方法二：使用 Android Studio

1. 打开项目
2. 菜单：`Build` → `Generate Signed Bundle / APK`
3. 选择 `APK`
4. 选择签名配置（会自动读取 `keystore.properties`）
5. 选择 `release` 构建类型
6. 点击 `Finish`

## 四、生成 AAB（Android App Bundle）

如果需要生成 AAB 格式（体积更小，但需要 Google Play 签名）：

```bash
./gradlew bundleRelease
```

生成的 AAB 文件位置：`app/build/outputs/bundle/release/app-release.aab`

## 五、版本号管理

在 `app/build.gradle.kts` 中修改版本信息：

```kotlin
defaultConfig {
    versionCode = 1  // 版本号（整数，每次更新递增）
    versionName = "1.0"  // 版本名称（字符串，如 "1.0.0"）
}
```

## 六、分发应用

### 直接分发 APK

1. 将生成的 `app-release.apk` 发送给用户
2. 用户需要在手机上开启"允许安装未知来源应用"权限
3. 用户点击 APK 文件进行安装

### 注意事项

- **首次安装**：用户可能需要允许"安装未知来源应用"
- **更新安装**：如果应用已安装，直接安装新版本即可（签名必须一致）
- **安全提示**：Android 系统可能会显示"此应用可能有害"的警告，这是正常的安全提示

## 七、常见问题

### 1. 签名文件丢失怎么办？

如果签名文件丢失，无法更新已安装的应用。需要：
- 重新生成签名文件
- 用户需要卸载旧版本后重新安装

### 2. 如何备份签名文件？

请妥善保管以下文件：
- `app/release.keystore`（密钥库文件）
- `keystore.properties`（密码信息）

建议加密备份到安全位置。

### 3. APK 体积太大？

- 已启用代码混淆和资源压缩
- 可以检查是否有未使用的资源
- 考虑使用 AAB 格式（需要 Google Play 签名）

### 4. 安装时提示"应用未签名"

检查 `keystore.properties` 配置是否正确，确保：
- 文件路径正确
- 密码正确
- 密钥别名正确

